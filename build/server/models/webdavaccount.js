// Generated by CoffeeScript 1.7.1
var WebDAVAccount, americano;

americano = require('americano-cozy');

module.exports = WebDAVAccount = americano.getModel('WebDAVAccount', {
  id: String,
  login: String,
  token: String,
  password: String,
  ctag: Number,
  cardctag: Number
});

WebDAVAccount.first = function(callback) {
  return WebDAVAccount.request('all', function(err, accounts) {
    var account;
    if (err) {
      return callback(err);
    } else if (!accounts || accounts.length === 0) {
      return callback(null, null);
    } else {
      account = accounts[0];
      if (account.token) {
        account.password = account.token;
      }
      delete account.token;
      return callback(null, account);
    }
  });
};

WebDAVAccount.set = function(data, callback) {
  data.token = data.password;
  delete data.password;
  return WebDAVAccount.first(function(err, account) {
    if (account == null) {
      return WebDAVAccount.create(data, callback);
    } else {
      return account.updateAttributes(data, callback);
    }
  });
};
